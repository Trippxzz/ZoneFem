{% extends 'base.html' %}
{% load static %}

{% block title %}Crear Beneficio - Ruleta{% endblock %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-white mb-2">
                <i class="fas fa-plus-circle mr-2"></i>
                Crear Nuevo Beneficio
            </h1>
            <p class="text-white/80">Agrega un nuevo premio a la ruleta</p>
        </div>
        <a href="{% url 'admin_ruleta' %}" 
           class="px-6 py-3 bg-white text-purple-600 rounded-lg hover:bg-purple-50 transition-all shadow-lg">
            <i class="fas fa-arrow-left mr-2"></i>
            Volver
        </a>
    </div>

    <!-- Mensajes -->
    {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
                <div class="bg-{% if message.tags == 'success' %}green{% elif message.tags == 'error' %}red{% else %}blue{% endif %}-500 text-white px-6 py-4 rounded-lg shadow-lg mb-3">
                    <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% else %}info-circle{% endif %} mr-2"></i>
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Formulario -->
    <div class="bg-white rounded-2xl shadow-2xl p-8">
        <form method="POST" id="beneficioForm">
            {% csrf_token %}
            
            <!-- Texto del Beneficio -->
            <div class="mb-6">
                <label for="texto" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-gift text-purple-600 mr-2"></i>
                    Texto del beneficio *
                </label>
                <input type="text" id="texto" name="texto" required maxlength="100"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                       placeholder="Ej: 20% de descuento en todos los servicios">
            </div>

            <!-- Tipo de Beneficio -->
            <div class="mb-6">
                <label for="tipo_beneficio" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-tag text-purple-600 mr-2"></i>
                    Tipo de beneficio *
                </label>
                <select id="tipo_beneficio" name="tipo_beneficio" required
                        onchange="updateBeneficioFields()"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <option value="">Selecciona un tipo...</option>
                    <option value="cupon">Cupón de Descuento Existente</option>
                    <option value="porcentaje">Descuento Porcentaje</option>
                    <option value="monto">Descuento Monto Fijo</option>
                </select>
            </div>

            <!-- Campo Cupón (solo si tipo=cupon) -->
            <div class="mb-6 hidden" id="campo_cupon">
                <label for="cupon" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-ticket-alt text-purple-600 mr-2"></i>
                    Cupón asociado *
                </label>
                <select id="cupon" name="cupon"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <option value="">Selecciona un cupón...</option>
                    {% for cupon in cupones %}
                    <option value="{{ cupon.id }}">
                        {{ cupon.codigo }} - 
                        {% if cupon.tipo_descuento == 'porcentaje' %}
                            {{ cupon.valor_descuento }}% off
                        {% else %}
                            ${{ cupon.valor_descuento }} off
                        {% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Campo Porcentaje (solo si tipo=porcentaje) -->
            <div class="mb-6 hidden" id="campo_porcentaje">
                <label for="valor_porcentaje" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-percentage text-purple-600 mr-2"></i>
                    Porcentaje de descuento (0-100) *
                </label>
                <input type="number" id="valor_porcentaje" name="valor_porcentaje" min="0" max="100"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                       placeholder="20">
            </div>

            <!-- Campo Monto (solo si tipo=monto) -->
            <div class="mb-6 hidden" id="campo_monto">
                <label for="valor_monto" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-dollar-sign text-purple-600 mr-2"></i>
                    Monto de descuento *
                </label>
                <input type="number" id="valor_monto" name="valor_monto" min="0" step="0.01"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                       placeholder="5000">
            </div>

            <!-- Probabilidad -->
            <div class="mb-6">
                <label for="probabilidad" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-dice text-purple-600 mr-2"></i>
                    Probabilidad (1-100)
                </label>
                <input type="number" id="probabilidad" name="probabilidad" value="10" min="1" max="100" required
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <p class="text-sm text-gray-500 mt-1">
                    <i class="fas fa-info-circle mr-1"></i>
                    Mayor número = mayor probabilidad de salir
                </p>
            </div>

            <!-- Color -->
            <div class="mb-6">
                <label for="color" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-palette text-purple-600 mr-2"></i>
                    Color de sector
                </label>
                <div class="flex gap-3">
                    <input type="color" id="color" name="color" value="#E982F2"
                           class="h-12 w-20 border-2 border-gray-300 rounded-lg cursor-pointer">
                    <input type="text" id="color_hex" name="color_hex" value="#E982F2" readonly
                           class="flex-1 px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm">
                </div>
            </div>

            <!-- Orden -->
            <div class="mb-6">
                <label for="orden" class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-sort-numeric-down text-purple-600 mr-2"></i>
                    Orden de visualización
                </label>
                <input type="number" id="orden" name="orden" value="0"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <p class="text-sm text-gray-500 mt-1">Menor número = aparece primero en la ruleta</p>
            </div>

            <!-- Activo -->
            <div class="mb-6">
                <label class="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" name="activo" id="activo" checked
                           class="w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                    <span class="text-sm font-semibold text-gray-700">
                        <i class="fas fa-toggle-on text-purple-600 mr-2"></i>
                        Beneficio activo
                    </span>
                </label>
            </div>

            <!-- Botones -->
            <div class="flex gap-3 pt-4 border-t border-gray-200">
                <button type="submit" 
                        class="flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all shadow-lg font-semibold">
                    <i class="fas fa-save mr-2"></i>
                    Crear Beneficio
                </button>
                <a href="{% url 'admin_ruleta' %}" 
                   class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all font-semibold">
                    <i class="fas fa-times mr-2"></i>
                    Cancelar
                </a>
            </div>
        </form>
    </div>

</div>

<script>
// Sincronizar color picker con input de texto
document.getElementById('color').addEventListener('input', function() {
    document.getElementById('color_hex').value = this.value;
});

// Actualizar campos según tipo de beneficio seleccionado
function updateBeneficioFields() {
    const tipo = document.getElementById('tipo_beneficio').value;
    
    // Ocultar todos los campos específicos
    document.getElementById('campo_cupon').classList.add('hidden');
    document.getElementById('campo_porcentaje').classList.add('hidden');
    document.getElementById('campo_monto').classList.add('hidden');
    
    // Remover required de todos
    document.getElementById('cupon').removeAttribute('required');
    document.getElementById('valor_porcentaje').removeAttribute('required');
    document.getElementById('valor_monto').removeAttribute('required');
    
    // Mostrar y requerir según tipo
    if (tipo === 'cupon') {
        document.getElementById('campo_cupon').classList.remove('hidden');
        document.getElementById('cupon').setAttribute('required', 'required');
    } else if (tipo === 'porcentaje') {
        document.getElementById('campo_porcentaje').classList.remove('hidden');
        document.getElementById('valor_porcentaje').setAttribute('required', 'required');
    } else if (tipo === 'monto') {
        document.getElementById('campo_monto').classList.remove('hidden');
        document.getElementById('valor_monto').setAttribute('required', 'required');
    }
}
</script>

{% endblock %}
