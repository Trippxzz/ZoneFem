<div class="main-content">
    <h1>Contenido Principal de la Página</h1>
    {% if user.is_authenticated %}
        <p>¡Hola, {{ user.first_name }}! Estás autenticado.</p>
        {%if user.rol == 'matrona'%}
            <a>Ir al Panel de Matrona</a>
        {% elif user.rol == 'usuario'%}
            <a>Ir al Panel de Paciente</a>
        {% endif %}
   <a href="{% url 'crearservicio' %}" class="block px-4 py-2 rounded-md text-gray-200 hover:text-white mb-2">Crear servicio</a>
      <a href="{% url 'verservicio' %}" class="block px-4 py-2 rounded-md text-gray-200 hover:text-white mb-2">Ver servicios</a>
        <form method="post" action="{% url 'logout' %}" style="display: inline;">
        {% csrf_token %} <button type="submit" class="btn btn-link">Cerrar Sesión</button>
    </form>
    {% else %}
        <button id="open-login-modal-btn">Iniciar Sesión</button>
    {% endif %}
</div>


<div id="login-modal" style="display: none;">
    <h2>Iniciar Sesión</h2>
    <form id="login-form" method="post" action="{% url 'login_ajax' %}">
        {% csrf_token %}
        {{ loginf.as_p }} 
        <div id="login-errors" style="color: red;"></div>
        <button type="submit">Entrar</button>
        <button type="button" id="close-login-modal-btn">Cerrar</button>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        const modal = $('#login-modal');
        const loginForm = $('#login-form');
        const errorDiv = $('#login-errors');

        $('#open-login-modal-btn').click(function() {
            modal.show(); 
        });
        $('#close-login-modal-btn').click(function() {
            modal.hide(); 
        });


        loginForm.submit(function(e) {
            e.preventDefault(); 
            errorDiv.empty(); 

            $.ajax({
                type: loginForm.attr('method'),
                url: loginForm.attr('action'),
                data: loginForm.serialize(),
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                    
                        window.location.href = response.redirect_url || "{% url 'home' %}";
                    } else {
                       
                        let errorsHtml = '';
                        for (const field in response.errors) {
                            response.errors[field].forEach(error => {
                                errorsHtml += `<p>${error}</p>`;
                            });
                        }
                        errorDiv.html(errorsHtml);
                    }
                },
                error: function() {
                    errorDiv.html('<p>Ocurrió un error de conexión.</p>');
                }
            });
        });
    });
</script>